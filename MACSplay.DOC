━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

	    MACS data Player「MACSplay.x」v1.06d
	    
		                                       2023/01/08 カタ

────────────────────────────────────

● 機能
X68000のMACSデータを再生するプレイヤーです。
特徴として、ハイメモリ環境があれば、ハイメモリを利用して12MBを超える
MACSデータの再生が可能になります。

● 使い方
MACSDRV.xを常駐させた後に、コマンドラインで以下を実行してください。

>MACSplay.x [Option] file

例１
>MACSplay.x -K BadApple.MCS
再生中、キー入力で再生を停止させません。

例２
>MACSplay.x -R0 BadApple.MCS
無限ループで再生させます。

● file
拡張子が.MCSのアニメーションデータです。
※ファイルがMACSデータであるかどうかの判定は実装していません。

● オプション[Option]

-D  パレットを50%暗くする		＜MACSDRVの特殊効果フラグ＞
	
-P  PCMの再生をしない 			＜MACSDRVの特殊効果フラグ＞

-K  キー入力時、終了しない 		＜MACSDRVの特殊効果フラグ＞

-C  アニメ終了時、画面を初期化しない 	＜MACSDRVの特殊効果フラグ＞

-SL MACSDRVがスリープしている時でも再生する ＜MACSDRVの特殊効果フラグ＞

-GR ｸﾞﾗﾌｨｯｸを表示したまま再生する 	＜MACSDRVの特殊効果フラグ＞

-SP ｽﾌﾟﾗｲﾄを表示したまま再生する 	＜MACSDRVの特殊効果フラグ＞

-AD PCM8A.Xの常駐をチェックしない(060turbo.sys -adで再生する場合)

  060turbo.sys -adで再生する場合、PCM8Aの常駐は不要であるため
  このオプション設定があります。

-Rx リピート再生するx=1～255回、x=0(無限ループ)

  リピート再生有効時、下記オプションの設定を変更します。
  「-K」のオプション設定を強制で無効化します。（キー入力で中断できます）
  「-C」のオプション設定が強制で有効化します。（リピートの継ぎ目を気にしてみました）

-HS 再生したファイルの履歴を残す。

  過去に再生したMACSファイルを「MACSPHIS.LOG」に記録します。
  ああ、これ見たことあるわ…を回避できます。すかさずESCキーを押しましょう！
 
-L プレイリスト<file>を読み込んで逐次再生する

  MACSファイルをフルパスで記載してください。
  メモリへロードして、再生、ロードして、再生を登録された順に行います。
  
-LA プレイリスト<file>を読み込んで再生する

  MACSファイルをフルパスで記載してください。
  登録された順にメモリへロードします。
  ファイルの読み込み中、メモリが足りなくなった場合は、読み込みを中断し
  読み込めたファイルだけで、再生します。

例：PlayList.txt の中身
W:\arc\MACS_data\特撮\SunVulcan_OP.MCS
W:\arc\MACS_data\ふしぎ遊戯\ふしぎ遊戯OP_14f.MCS

例：コマンド
>MACSplay.x -L PlayList.txt

● ハイメモリで再生（030機種以降、PhantomX等の030、040、060のエミュレーション可）
  通常メインメモリに載らないサイズのMACSデータは再生できません。
  そこでハイメモリを使うことができないか考えました。
  実現方法は、ハイメモリの実装(IOCS $F8)を判別し、メモリ確保しているだけです。
  ハイメモリ利用の判別は、メインメモリの空きと、MACSデータのファイルサイズを比較します。
  ハイメモリからPCMを再生するには、PCM8Aもしくは、060turbo.sysの機能が
  必要になります。（ハイメモリのアドレスは、DMAの範囲外であるため）

  ・PCM8Aを使う場合
    >PCM8A -w18
    で予め常駐してください。
  
  ・060turbo.sysを使う場合
    060turbo.sysのドライバ組み込み時に -adのオプション設定を行い、
    再生時は、MACSplay.x -AD のオプションを追加ください。

● 040Excel/060Excel機種について
  実力不足でメモリ確保できず、再生できません。（誰か教えて～

● 8MBオーバーのMACSデータについて
  HLK evolution version 3.01+15以降で作成できるようになります。
  オプション設定 -rを使うことで、CV.Xを使うことなく.r形式の実行ファイルが作れます。

● 用語集（本プログラムに限る）
  ハイメモリ	：16MB以降のメモリ空間（68030以降のMPUに限る）
  メインメモリ	：X68000のSWITCH.Xで設定できる範囲のメモリ空間(12MB)
  
● 履歴
2023/01/08 1.06d	不具合修正
			パスの取得処理でコマンドの引数がファイル名単体の場合、
			パス名がファイル名になっていた。
			
2023/01/07 1.06c	HUPAIR対応、ロード中の表示変更、Qキーで強制終了
			以下の不具合を修正
			①メモリ解放処理修正
			　ファイルの読み込み途中でスキップすると、
			　何故かハイメモリの空き容量が極端に減ってしまい、
			　リトライの際殆ど読み込めなくなる問題を解消
			②ループが終了できない
			　-Lと-R0オプション同時使用の場合はESCキーで一周しても
			　延々次の曲に飛んで、リセットしないとHumanに復帰しない問題を解消
			③ファイル再生時、0MBって表示される

2022/12/26 1.06b	再生したファイルの履歴を残す機能-HSの追加 

2022/12/04 1.06a	リストファイルによる再生機能-LAの追加 
			メモリ解放のバグ修正

2022/11/29 1.06		リストファイルによる再生機能-Lの追加

2022/09/20 1.05a	バージョンチェック機能を変更
			MACSDRV Version 1.16の勝手に改造版 v0.15.11以降の
			改造リビジョン取得コマンド追加に対応しました。
			
2022/09/17 1.05		バージョンチェック機能を追加
			元祖のMACSDRV.X(Ver1.16)で、MACSDRV Version 1.16の勝手に改造版のデータを再生すると。
			動画再生されず、再生完了となってしまう不具合を修正した。

2022/07/09 1.04お試し版		タイトル、コメント等の情報表示を追加
			ファイルロード中にキャンセルできるよう追加
			
2022/06/29 1.03		ファイルの読み込みが長くて心配なので進捗表示を追加しました。
			ハイメモリでの再生判定を見直しました。

2022/05/15 1.02		040Excel/060Excel非対応（MALLOC3でメモリ確保できませんでした。）
			リファクタリングした。

2022/05/09 1.01a	「ローカルメモリ」の意味を間違っていたので「メインメモリ」に修正した。

2022/05/05 1.01		「メインメモリ」の空き容量の計算が間違っていました。
			アボート時、ADPCMの再生を停止していましたが、
			本プログラム終了時は、必ずADPCMの再生を停止するようにしました。

2022/05/03 1.00		初版
